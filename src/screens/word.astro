---
import Layout from "~/layouts/PageLayout.astro";
import Hero from "~/components/widgets/Hero.astro";
import { useTranslations } from "~/i18n/utils";
import { TextAnimate } from "~/components/magicui/text-animate";
import power_of_the_words from "~/assets/videos/4.mp4";
import { BlurFade } from "~/components/magicui/blur-fade";
import FireButton from "~/components/ui/FireButton.astro";
import WordList from "~/components/widgets/WordList.astro";
// Word images
import word_bible from "~/assets/images/index/fire_of_god_and_fire_for_god-bible.webp";
import word_fire from "~/assets/images/index/fire_of_god_and_fire_for_god-fire.webp";
import word_company from "~/assets/images/index/fire_of_god_and_fire_for_god-company.webp";
import word_prayer from "~/assets/images/fire_of_god_and_fire_for_god-prayer.webp";
import word_tree from "~/assets/images/fire_of_god_and_fire_for_god-tree1.webp";
import word_city from "~/assets/images/fire_of_god_and_fire_for_god-city_in_flame.webp";
import word_derek_prince from "~/assets/images/ministries/fire_of_god_and_fire_for_god-derek_prince.webp";
import word_kenneth_hagin from "~/assets/images/ministries/fire_of_god_and_fire_for_god-kenneth_hagin.webp";
import word_koinonia from "~/assets/images/ministries/fire_of_god_and_fire_for_god-koinonia.webp";
import word_prayer_church from "~/assets/images/ministries/fire_of_god_and_fire_for_god-prayer_church.webp";
// import { ENDPOINTS } from "~/config/endpoints";

const { metadata, siteRebuildStatus, lang } = Astro.props;

const t = useTranslations(lang);

// Word items data structure
const wordItems = [
  {
    image: word_bible,
    title: "The Word is Life",
    subtitle: "Scripture brings transformation",
    description:
      "God's Word is living and active, sharper than any double-edged sword. It penetrates even to dividing soul and spirit, joints and marrow; it judges the thoughts and attitudes of the heart.",
    color: "blue" as const,
    emoji: "üìñ",
  },
  {
    image: word_fire,
    title: "Fire of His Presence",
    subtitle: "Divine fire purifies and empowers",
    description:
      "The fire of God's presence burns away impurities and ignites passion for righteousness. His fire refines us like gold and silver, making us vessels of honor.",
    color: "orange" as const,
    emoji: "üî•",
  },
  {
    image: word_prayer,
    title: "Prayer Changes Everything",
    subtitle: "Communication with the Almighty",
    description:
      "Through prayer, we align our hearts with God's will. It's our direct line to heaven, where miracles are born and destinies are shaped by divine intervention.",
    color: "purple" as const,
    emoji: "üôè",
  },
  {
    image: word_company,
    title: "Fellowship of Believers",
    subtitle: "Unity in the Spirit",
    description:
      "Iron sharpens iron, and believers sharpen one another. In fellowship, we find encouragement, accountability, and the power of agreement in prayer.",
    color: "green" as const,
    emoji: "ü§ù",
  },
  {
    image: word_tree,
    title: "Rooted in Truth",
    subtitle: "Growing in spiritual maturity",
    description:
      "Like a tree planted by streams of water, those rooted in God's Word yield fruit in season. Their leaves do not wither, and whatever they do prospers.",
    color: "indigo" as const,
    emoji: "üå≥",
  },
  {
    image: word_city,
    title: "City on a Hill",
    subtitle: "Light in the darkness",
    description:
      "We are called to be a city on a hill, a light that cannot be hidden. Our lives should illuminate the path to salvation for all who see our good works.",
    color: "yellow" as const,
    emoji: "üèôÔ∏è",
  },
  {
    image: word_derek_prince,
    title: "Wisdom of the Ages",
    subtitle: "Learning from spiritual fathers",
    description:
      "God raises up teachers and prophets to guide His people. Through their wisdom and revelation, we gain deeper understanding of His ways and purposes.",
    color: "red" as const,
    emoji: "üß†",
  },
  {
    image: word_kenneth_hagin,
    title: "Faith that Moves Mountains",
    subtitle: "Walking in supernatural power",
    description:
      "Faith comes by hearing, and hearing by the Word of God. When we speak in faith, mountains move and impossibilities become possibilities through Christ.",
    color: "pink" as const,
    emoji: "‚õ∞Ô∏è",
  },
  {
    image: word_koinonia,
    title: "Divine Partnership",
    subtitle: "Koinonia with the Holy Spirit",
    description:
      "True fellowship is koinonia - a divine partnership where heaven and earth unite. In this sacred communion, we experience God's presence and power.",
    color: "blue" as const,
    emoji: "ü§≤",
  },
  {
    image: word_prayer_church,
    title: "House of Prayer",
    subtitle: "Where heaven touches earth",
    description:
      "My house shall be called a house of prayer for all nations. In the place of prayer, miracles happen, lives are transformed, and God's kingdom advances.",
    color: "orange" as const,
    emoji: "‚õ™",
  },
];
---

<Layout lang={lang} metadata={metadata} siteRebuildStatus={siteRebuildStatus}>
  <div class="min-h-screen relative overflow-hidden">
    <!-- Video Background -->

    <!-- data-src={`${ENDPOINTS.publicFiles}/fire_of_god_and_fire_for_god-fire_bg.mp4`} -->
    <video
      id="hero-video"
      aria-label={t("index.hero.video.aria")}
      class="absolute inset-0 w-full h-full object-cover z-0 opacity-0 transition-opacity duration-1000 ease-in-out"
      data-src={power_of_the_words}
      autoplay
      loop
      muted
      playsinline
      preload="auto"
    >
      {t("index.hero.video.browser")}
    </video>

    <Hero classes={{ containerClass: "relative z-10" }}>
      <Fragment slot="title">
        <div class="flex flex-col justify-center">
          <TextAnimate
            client:load
            className="text-4xl xs:text-5xl md:text-6xl xl:text-[60px] xl:leading-[64px] font-semibold leading-tight tracking-tighter md:mb-4 xl:mb-[16px] font-heading text-white"
            animation="blurInUp"
            delay={1}
            duration={0.6}
            by="character"
            once={true}
            text={t("word.hero.title.1")}
          />
          <TextAnimate
            client:load
            className="text-4xl xs:text-5xl md:text-6xl xl:text-[60px] xl:leading-[64px] font-semibold leading-tight tracking-tighter mb-4 xl:mb-[16px] font-heading text-orange-400"
            animation="blurInUp"
            delay={1.6}
            duration={0.6}
            by="character"
            once={true}
            text={"Transform your speech"}
          />
        </div>
      </Fragment>

      <Fragment slot="subtitle">
        <div class="flex justify-center mb-8 xl:mb-[32px]">
          <div class="max-w-2xl px-4">
            <BlurFade client:load delay={3} direction="up" inView>
              <div class="relative">
                <!-- Enhanced background with stronger contrast -->
                <div
                  class="absolute inset-0 bg-gradient-to-r from-blue-600/40 via-purple-600/40 to-orange-600/40 blur-2xl rounded-lg"
                >
                </div>

                <!-- Secondary glow layer -->
                <div class="absolute inset-0 bg-black/60 blur-lg rounded-lg"></div>

                <!-- Main subtitle container with enhanced glass morphism -->
                <div
                  class="relative backdrop-blur-xl bg-gradient-to-r from-black/40 via-black/50 to-black/40 border-2 border-white/30 rounded-2xl px-8 py-6 shadow-2xl"
                  style="box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.2);"
                >
                  <!-- Strong inner glow -->
                  <div
                    class="absolute inset-0 bg-gradient-to-r from-blue-400/15 via-white/10 to-orange-400/15 rounded-2xl"
                  >
                  </div>

                  <!-- Text content with multiple text shadows -->
                  <div class="relative">
                    <span class="block text-xl xl:text-[20px] xl:leading-[28px] tracking-normal text-center text-white">
                      {t("word.hero.subtitle.1")}
                    </span>

                    <!-- Enhanced decorative elements -->
                    <div class="flex justify-center mt-4">
                      <div class="flex items-center space-x-2">
                        <div
                          class="w-8 h-0.5 bg-gradient-to-r from-transparent via-blue-400/80 to-blue-400/80 rounded-full"
                        >
                        </div>
                        <div
                          class="w-2 h-2 bg-white/80 rounded-full shadow-lg"
                          style="box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);"
                        >
                        </div>
                        <div
                          class="w-8 h-0.5 bg-gradient-to-l from-transparent via-orange-400/80 to-orange-400/80 rounded-full"
                        >
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Corner accents -->
                  <div class="absolute top-2 left-2 w-3 h-3 border-t-2 border-l-2 border-white/40 rounded-tl-lg"></div>
                  <div class="absolute top-2 right-2 w-3 h-3 border-t-2 border-r-2 border-white/40 rounded-tr-lg"></div>
                  <div class="absolute bottom-2 left-2 w-3 h-3 border-b-2 border-l-2 border-white/40 rounded-bl-lg">
                  </div>
                  <div class="absolute bottom-2 right-2 w-3 h-3 border-b-2 border-r-2 border-white/40 rounded-br-lg">
                  </div>
                </div>

                <!-- Enhanced floating particles -->
                <div
                  class="absolute -top-3 -left-3 w-3 h-3 bg-blue-400 rounded-full animate-pulse shadow-lg"
                  style="box-shadow: 0 0 15px rgba(59, 130, 246, 0.8);"
                >
                </div>
                <div
                  class="absolute -top-2 -right-4 w-2 h-2 bg-purple-400 rounded-full animate-pulse delay-300 shadow-lg"
                  style="box-shadow: 0 0 10px rgba(147, 51, 234, 0.8);"
                >
                </div>
                <div
                  class="absolute -bottom-3 -right-2 w-3 h-3 bg-orange-400 rounded-full animate-pulse delay-700 shadow-lg"
                  style="box-shadow: 0 0 15px rgba(251, 146, 60, 0.8);"
                >
                </div>
                <div
                  class="absolute -bottom-1 -left-4 w-1.5 h-1.5 bg-white rounded-full animate-pulse delay-1000 shadow-lg"
                  style="box-shadow: 0 0 8px rgba(255, 255, 255, 0.9);"
                >
                </div>
              </div>
            </BlurFade>
          </div>
        </div>
      </Fragment>
    </Hero>

    <!-- Actions positioned at bottom right of the full screen -->
    <div class="absolute bottom-40 right-8 lg:right-12 flex z-20">
      <BlurFade client:load delay={4.2} direction="up" inView>
        <FireButton
          id="show-video-btn"
          text={"I want the power of the words in my life ‚úã"}
          variant="primary"
          size="small"
          icon="tabler:arrow-right"
        />
      </BlurFade>
    </div>
  </div>

  <WordList wordItems={wordItems} />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const heroVideo = document.getElementById("hero-video") as HTMLVideoElement;
    const showVideoBtn = document.getElementById("show-video-btn") as HTMLElement;
    let videoLoaded = false;
    let videoDisplayed = false;

    // Load video after 2 seconds but keep it hidden
    if (heroVideo) {
      setTimeout(() => {
        const videoSrc = heroVideo.dataset.src;

        if (videoSrc && !heroVideo.src) {
          heroVideo.src = videoSrc;
          heroVideo.preload = "metadata";
          heroVideo.load();
        }

        // Set up event listener for when video has loaded enough data
        const handleVideoLoaded = () => {
          videoLoaded = true;
          console.log("Video loaded and ready to display");
          heroVideo.removeEventListener("loadeddata", handleVideoLoaded);
        };

        heroVideo.addEventListener("loadeddata", handleVideoLoaded);

        // Fallback: if video is already loaded (cached)
        if (heroVideo.readyState >= 2) {
          handleVideoLoaded();
        }
      }, 2000);
    }

    // Function to display video and handle auto-scroll
    const displayVideo = () => {
      if (!videoLoaded || videoDisplayed) return;

      videoDisplayed = true;

      // Fade in the video and gradient
      heroVideo.classList.remove("opacity-0");
      heroVideo.classList.add("opacity-100");

      // Start playing the video
      const playPromise = heroVideo.play();

      if (playPromise !== undefined) {
        playPromise
          .then(() => {
            console.log("Video started successfully");
          })
          .catch((error) => {
            console.log("Video autoplay failed:", error);
          });
      }

      // Auto-scroll to #word-list after 2 seconds of video display
      setTimeout(() => {
        const wordListSection = document.getElementById("word-list");
        if (wordListSection) {
          wordListSection.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }
      }, 3200);
    };

    // Add click event listener to fire button
    if (showVideoBtn) {
      showVideoBtn.addEventListener("click", (e) => {
        e.preventDefault();
        displayVideo();
      });
    }
  });
</script>
